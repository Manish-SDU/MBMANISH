<!DOCTYPE html><html lang="en">
<!-- Mirrored from www.python-engineer.com/posts/apple-health-data-python/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Sep 2022 12:01:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head><meta charset="UTF-8"/><meta name="og:site_name" content="Python Engineer"/><link rel="canonical" href="https://python-engineer.com/posts/apple-health-data-python"/><meta name="twitter:url" content="https://python-engineer.com/posts/apple-health-data-python"/><meta name="og:url" content="https://python-engineer.com/posts/apple-health-data-python"/><title>How To Analyze Apple Health Data With Python | Python Engineer</title><meta name="twitter:title" content="How To Analyze Apple Health Data With Python | Python Engineer"/><meta name="og:title" content="How To Analyze Apple Health Data With Python | Python Engineer"/><meta name="description" content="In this article we learn how to analyze Apple Health Data with Python."/><meta name="twitter:description" content="In this article we learn how to analyze Apple Health Data with Python."/><meta name="og:description" content="In this article we learn how to analyze Apple Health Data with Python."/><meta name="twitter:card" content="summary_large_image"/><link rel="stylesheet" href="../../styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="../../images/favicon.png" type="image/png"/><link rel="alternate" href="../../feed.rss" type="application/rss+xml" title="Subscribe to Python Engineer"/><meta name="twitter:image" content="https://python-engineer.com/applehealth.webp"/><meta name="og:image" content="https://python-engineer.com/applehealth.webp"/><script async defer data-domain="python-engineer.com" src="../../../plausible.io/js/plausible.js"></script></head><body class="item"><header><div class="header-promotion"><p><div class="wrapper"><p><a href="https://pythonengineer.pallet.com/" target="_blank">üêç Find Python and ML Jobs! üêç</a></p></div></p></div><div class="wrapper"><nav><ul><li class="selected"><a href="../index.html">POSTS</a></li><li><a href="../../courses/index.html">COURSES</a></li><li><a href="../../about/index.html">ABOUT</a></li></ul></nav><a href="../../index.html"><div class="hero-container"><img class="header-image-small" src="../../images/pat_face_bg.webp" alt="Patrick Loeber"/><div class="hero-text-container justify-center"><p>Become a</p><h1 class="colorized-text ">Python Engineer</h1><p class="mobile-hide">Come and learn about</p><ul class="mobile-hide"><li><a class="variant-a" href="../../tags/python/index.html">Python</a></li><li id="regular-li">and</li><li><a class="variant-b" href="../../tags/machine-learning/index.html">Machine Learning</a></li></ul></div></div></a></div></header><article class="page wrapper post-page"><h1 class="blog-header">How To Analyze Apple Health Data With Python</h1><div class="metadata"><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li></ul><span class="post-date">02 Jan 2022, by </span><a class="author-link-post" href="../../authors/patrick/index.html">Patrick Loeber</a></div><div class="blog-image"><img alt="Thumbnail image of the post." src="../../images/titles/applehealth.webp"/></div><div class="content page-content m-top"><p>In this article we learn how to analyze Apple Health Data with Python. We learn how to</p><ul><li>Load the workout data from the xml file into a pandas DataFrame</li><li>Extract different statistics like duration and kcal burned per workout</li><li>Extract, analyze, and plot the heart rate data</li><li>Filter workouts by type or by time period</li><li>Plot a pie chart to see the percentage of different workout types</li></ul><h2>Get the data</h2><p>On your iPhone go to Health App -&gt; Profile -&gt; Export data -&gt; Send to your computer.</p><p>This should send a <em>Export.zip</em> file to your Downloads folder. Create a new folder for this project and put the <em>Export.xml</em> file into another subfolder called <em>data</em>. All other files can be ignored here.</p><h2>Dependencies</h2><p>We need <em>pandas</em> and <em>matplotlib</em>. Create a new project and install both libraries, e.g. with pip:</p><pre><code><div class="highlight"><span></span><span class="err">$</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">pandas</span> <span class="n">matplotlib</span>
</div></code></pre><h2>Import XML in Python</h2><p>Create a new file (or a jupyter notebook) in the base of your project folder and then import the data:</p><pre><code><div class="highlight"><span></span><span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;fivethirtyeight&quot;</span><span class="p">)</span>

<span class="c1"># create element tree object</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;data/Export.xml&#39;</span><span class="p">)</span> 
<span class="c1"># for every health record, extract the attributes</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
<span class="n">record_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">attrib</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s1">&#39;Record&#39;</span><span class="p">)]</span>
</div></code></pre><h2>Create Pandas DataFrame</h2><p>Create a pandas DataFrame. Then we adjust some data types and value names:</p><pre><code><div class="highlight"><span></span><span class="n">record_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">record_list</span><span class="p">)</span>

<span class="c1"># proper type to dates</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;creationDate&#39;</span><span class="p">,</span> <span class="s1">&#39;startDate&#39;</span><span class="p">,</span> <span class="s1">&#39;endDate&#39;</span><span class="p">]:</span>
    <span class="n">record_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">record_data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>

<span class="c1"># value is numeric, NaN if fails</span>
<span class="n">record_data</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">record_data</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># some records do not measure anything, just count occurences</span>
<span class="c1"># filling with 1.0 (= one time) makes it easier to aggregate</span>
<span class="n">record_data</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">record_data</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># shorter observation names</span>
<span class="n">record_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">record_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;HKQuantityTypeIdentifier&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">record_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">record_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;HKCategoryTypeIdentifier&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">record_data</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</div></code></pre><p>The record_data looks like this:</p><img src="../../images/2022-01-02-apple-health/recorddata.png"Record data"" alt="alt text"/><h2>Extract workouts</h2><p>Extract only the workout data and create another DataFrame for it:</p><pre><code><div class="highlight"><span></span><span class="n">workout_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">attrib</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s1">&#39;Workout&#39;</span><span class="p">)]</span>

<span class="c1"># create DataFrame</span>
<span class="n">workout_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">workout_list</span><span class="p">)</span>
<span class="n">workout_data</span><span class="p">[</span><span class="s1">&#39;workoutActivityType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">workout_data</span><span class="p">[</span><span class="s1">&#39;workoutActivityType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;HKWorkoutActivityType&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">workout_data</span> <span class="o">=</span> <span class="n">workout_data</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;workoutActivityType&quot;</span><span class="p">:</span> <span class="s2">&quot;Type&quot;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># proper type to dates</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;creationDate&#39;</span><span class="p">,</span> <span class="s1">&#39;startDate&#39;</span><span class="p">,</span> <span class="s1">&#39;endDate&#39;</span><span class="p">]:</span>
    <span class="n">workout_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">workout_data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
 
<span class="c1"># convert string to numeric   </span>
<span class="n">workout_data</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">workout_data</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">])</span>
<span class="n">workout_data</span><span class="p">[</span><span class="s1">&#39;totalEnergyBurned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">workout_data</span><span class="p">[</span><span class="s1">&#39;totalEnergyBurned&#39;</span><span class="p">])</span>
<span class="n">workout_data</span><span class="p">[</span><span class="s1">&#39;totalDistance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">workout_data</span><span class="p">[</span><span class="s1">&#39;totalDistance&#39;</span><span class="p">])</span>
<span class="n">workout_data</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</div></code></pre><p>This will show something like this. (Note: The additional columns <em>device</em>, <em>creationDate</em>, <em>startDate</em>, and <em>endDate</em> are not visible on this image:</p><img src="../../images/2022-01-02-apple-health/workoutdata.png"Workout data"" alt="alt text"/><h2>Get the number of workouts</h2><pre><code><div class="highlight"><span></span><span class="n">num_workouts</span> <span class="o">=</span> <span class="n">workout_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</div></code></pre><h2>Filter workouts by type</h2><pre><code><div class="highlight"><span></span><span class="k">def</span> <span class="nf">get_workouts</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">workout_type</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">workout_type</span><span class="p">]</span>

<span class="c1"># to see the different workout types use:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">workout_data</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="c1"># [&#39;Running&#39; &#39;FunctionalStrengthTraining&#39; &#39;Yoga&#39;</span>
<span class="c1">#  &#39;HighIntensityIntervalTraining&#39; &#39;CoreTraining&#39;]</span>

<span class="n">running_data</span> <span class="o">=</span> <span class="n">get_workouts</span><span class="p">(</span><span class="n">workout_data</span><span class="p">,</span> <span class="s2">&quot;Running&quot;</span><span class="p">)</span>
</div></code></pre><h2>Get workouts in certain time period</h2><pre><code><div class="highlight"><span></span><span class="k">def</span> <span class="nf">get_workouts_from_to</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">workouts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;creationDate&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">]</span>
    <span class="n">workouts</span> <span class="o">=</span> <span class="n">workouts</span><span class="p">[</span><span class="n">workouts</span><span class="p">[</span><span class="s2">&quot;creationDate&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">workouts</span>

<span class="n">lower_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">upper_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">workouts</span> <span class="o">=</span> <span class="n">get_workouts_from_to</span><span class="p">(</span><span class="n">workout_data</span><span class="p">,</span> <span class="n">lower_time</span><span class="p">,</span> <span class="n">upper_time</span><span class="p">)</span>

<span class="c1"># or relative to the current day</span>
<span class="n">today</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="n">xdaysago</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="c1"># first_of_month = today - dt.timedelta(days=today.day - 1)</span>
<span class="n">workouts</span> <span class="o">=</span> <span class="n">get_workouts_from_to</span><span class="p">(</span><span class="n">workout_data</span><span class="p">,</span> <span class="n">xdaysago</span><span class="p">,</span> <span class="n">today</span><span class="p">)</span>
</div></code></pre><h2>Get last workout</h2><pre><code><div class="highlight"><span></span><span class="n">last_workout</span> <span class="o">=</span> <span class="n">workouts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</div></code></pre><h2>Extract heart rate</h2><p>Extract the heart rate data and put it into a DataFrame. Then we can extract heart rate statistics for certain workouts:</p><pre><code><div class="highlight"><span></span><span class="k">def</span> <span class="nf">get_heartrate_for_workout</span><span class="p">(</span><span class="n">heartrate</span><span class="p">,</span> <span class="n">workout</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_heartrate_for_date</span><span class="p">(</span><span class="n">hr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="n">hr</span> <span class="o">=</span> <span class="n">hr</span><span class="p">[</span><span class="n">hr</span><span class="p">[</span><span class="s2">&quot;startDate&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">]</span>
        <span class="n">hr</span> <span class="o">=</span> <span class="n">hr</span><span class="p">[</span><span class="n">hr</span><span class="p">[</span><span class="s2">&quot;endDate&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">hr</span>
    <span class="k">return</span> <span class="n">get_heartrate_for_date</span><span class="p">(</span><span class="n">heartrate</span><span class="p">,</span> <span class="n">workout</span><span class="p">[</span><span class="s2">&quot;startDate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">workout</span><span class="p">[</span><span class="s2">&quot;endDate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

<span class="n">heartrate_data</span> <span class="o">=</span> <span class="n">record_data</span><span class="p">[</span><span class="n">record_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;HeartRate&quot;</span><span class="p">]</span>

<span class="c1"># Extract heartrate statistics for certain workout</span>
<span class="n">last_workout</span> <span class="o">=</span> <span class="n">workouts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">heartrate_workout</span> <span class="o">=</span> <span class="n">get_heartrate_for_workout</span><span class="p">(</span><span class="n">heartrate_data</span><span class="p">,</span> <span class="n">last_workout</span><span class="p">)</span>
<span class="n">minh</span> <span class="o">=</span> <span class="n">heartrate_workout</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">maxh</span> <span class="o">=</span> <span class="n">heartrate_workout</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">meanh</span> <span class="o">=</span> <span class="n">heartrate_workout</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">last_workout</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">minh</span><span class="p">,</span> <span class="n">maxh</span><span class="p">,</span> <span class="n">meanh</span><span class="p">)</span>
<span class="c1"># HighIntensityIntervalTraining 74.0 176.0 151.2590909090909</span>
</div></code></pre><h2>Plot heart rate for workout</h2><pre><code><div class="highlight"><span></span><span class="n">heartrate_workout</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;endDate&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;r|&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">8.5</span><span class="p">,</span>  <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</div></code></pre><img src="../../images/2022-01-02-apple-health/hr.png"Heart Rate"" alt="alt text"/><h2>Put more statistics into DataFrame</h2><pre><code><div class="highlight"><span></span><span class="k">def</span> <span class="nf">get_hr_for_workout_row</span><span class="p">(</span><span class="n">workout</span><span class="p">,</span> <span class="n">heartrate</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_hr_for_date</span><span class="p">(</span><span class="n">hr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="n">hr</span> <span class="o">=</span> <span class="n">hr</span><span class="p">[</span><span class="n">hr</span><span class="p">[</span><span class="s2">&quot;startDate&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">]</span>
        <span class="n">hr</span> <span class="o">=</span> <span class="n">hr</span><span class="p">[</span><span class="n">hr</span><span class="p">[</span><span class="s2">&quot;endDate&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">hr</span>
    <span class="k">return</span> <span class="n">get_hr_for_date</span><span class="p">(</span><span class="n">heartrate</span><span class="p">,</span> <span class="n">workout</span><span class="p">[</span><span class="s2">&quot;startDate&quot;</span><span class="p">],</span> <span class="n">workout</span><span class="p">[</span><span class="s2">&quot;endDate&quot;</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">convert_to_minute_proportion</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">number</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_pace_for_workout</span><span class="p">(</span><span class="n">workout</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">workout</span><span class="p">[</span><span class="s2">&quot;totalDistance&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="c1"># pace=min/km</span>
    <span class="n">pace</span> <span class="o">=</span> <span class="n">workout</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">workout</span><span class="p">[</span><span class="s2">&quot;totalDistance&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">convert_to_minute_proportion</span><span class="p">(</span><span class="n">pace</span><span class="p">)</span>


<span class="n">workouts</span><span class="p">[</span><span class="s2">&quot;heartrate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">workouts</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">get_hr_for_workout_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">heartrate_data</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">workouts</span><span class="p">[</span><span class="s2">&quot;hr_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">workouts</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;heartrate&#39;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">workouts</span><span class="p">[</span><span class="s2">&quot;pace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">workouts</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">get_pace_for_workout</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</div></code></pre><h2>Get statistics</h2><pre><code><div class="highlight"><span></span><span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="n">workouts</span><span class="p">):</span>
    <span class="n">total_kcal</span> <span class="o">=</span> <span class="n">workouts</span><span class="p">[</span><span class="s2">&quot;totalEnergyBurned&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">total_dist</span> <span class="o">=</span> <span class="n">workouts</span><span class="p">[</span><span class="s2">&quot;totalDistance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">total_time</span> <span class="o">=</span> <span class="n">workouts</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">total_time_hours</span> <span class="o">=</span> <span class="n">convert_to_minute_proportion</span><span class="p">(</span><span class="n">total_time</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">total_time_mins</span> <span class="o">=</span> <span class="n">convert_to_minute_proportion</span><span class="p">(</span><span class="n">total_time</span><span class="p">)</span>
 
    <span class="n">avg_kcal</span> <span class="o">=</span> <span class="n">workouts</span><span class="p">[</span><span class="s2">&quot;totalEnergyBurned&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">avg_dist</span> <span class="o">=</span> <span class="n">workouts</span><span class="p">[</span><span class="n">workouts</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Running&quot;</span><span class="p">][</span><span class="s2">&quot;totalDistance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">avg_pace</span> <span class="o">=</span> <span class="n">workouts</span><span class="p">[</span><span class="n">workouts</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Running&quot;</span><span class="p">][</span><span class="s2">&quot;pace&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">avg_time</span> <span class="o">=</span> <span class="n">workouts</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">avg_time_hours</span> <span class="o">=</span> <span class="n">convert_to_minute_proportion</span><span class="p">(</span><span class="n">avg_time</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">avg_time_mins</span> <span class="o">=</span> <span class="n">convert_to_minute_proportion</span><span class="p">(</span><span class="n">avg_time</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Workout statistics from </span><span class="si">{</span><span class="n">lower_time</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">upper_time</span><span class="o">-</span><span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">workouts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> workouts&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time: </span><span class="si">{</span><span class="n">total_time_mins</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> minutes (</span><span class="si">{</span><span class="n">total_time_hours</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> hours)</span><span class="se">\n</span><span class="s2">Calories burned: </span><span class="si">{</span><span class="n">total_kcal</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">kcal</span><span class="se">\n</span><span class="s2">Running distance: </span><span class="si">{</span><span class="n">total_dist</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">km&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Average per workout:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time: </span><span class="si">{</span><span class="n">avg_time_mins</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> minutes (</span><span class="si">{</span><span class="n">avg_time_hours</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> hours)</span><span class="se">\n</span><span class="s2">Calories burned: </span><span class="si">{</span><span class="n">avg_kcal</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">kcal</span><span class="se">\n</span><span class="s2">Running distance: </span><span class="si">{</span><span class="n">avg_dist</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">km</span><span class="se">\n</span><span class="s2">Running pace: </span><span class="si">{</span><span class="n">avg_pace</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">km/h&quot;</span><span class="p">)</span>

<span class="n">get_stats</span><span class="p">(</span><span class="n">workouts</span><span class="p">)</span>
</div></code></pre><pre><code><div class="highlight"><span></span><span class="go">Workout statistics from 2021-01-01 to 2021-12-31</span>
<span class="go">133 workouts</span>
<span class="go">Time: 2699.33 minutes (44.60 hours)</span>
<span class="go">Calories burned: 25630.65kcal</span>
<span class="go">Running distance: 311.67km</span>

<span class="go">Average per workout:</span>
<span class="go">Time: 20.18 minutes (0.20 hours)</span>
<span class="go">Calories burned: 192.71kcal</span>
<span class="go">Running distance: 3.90km</span>
<span class="go">Running pace: 5.69km/h</span>
</div></code></pre><h2>Plot workout pie chart</h2><pre><code><div class="highlight"><span></span><span class="k">def</span> <span class="nf">plot_workouts</span><span class="p">(</span><span class="n">workouts</span><span class="p">):</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">slices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">wo_type</span> <span class="ow">in</span> <span class="n">workouts</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wo_type</span><span class="p">)</span>
        <span class="n">wo_of_type</span> <span class="o">=</span> <span class="n">workouts</span><span class="p">[</span><span class="n">workouts</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">wo_type</span><span class="p">]</span>
        <span class="n">num_workouts_of_type</span> <span class="o">=</span> <span class="n">wo_of_type</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">slices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num_workouts_of_type</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">make_autopct</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">my_autopct</span><span class="p">(</span><span class="n">pct</span><span class="p">):</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">pct</span><span class="o">*</span><span class="n">total</span><span class="o">/</span><span class="mf">100.0</span><span class="p">))</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{p:.2f}</span><span class="s1">%  (</span><span class="si">{v:d}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">pct</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">my_autopct</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">slices</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="n">make_autopct</span><span class="p">(</span><span class="n">slices</span><span class="p">),</span>
            <span class="n">wedgeprops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">})</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Workouts in 2021&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_workouts</span><span class="p">(</span><span class="n">workouts</span><span class="p">)</span>
</div></code></pre><img src="../../images/2022-01-02-apple-health/workoutpie.png"Pie Chart"" alt="alt text"/></div><ul class="actions"><li><a class="youtube-button" href="https://www.youtube.com/channel/UCbXgNpp0jedKWcQiULLbDTA?sub_confirmation=1" target="_blank" rel="nofollow">Subscribe</a></li><li><a class="twitter-button" href="https://twitter.com/intent/tweet?via=python_engineer&amp;text=How%20To%20Analyze%20Apple%20Health%20Data%20With%20Python&amp;url=https://python-engineer.com/posts/apple-health-data-python" rel="nofollow" target="_blank">Share</a></li></ul><div class="affiliate-container"><div><h2>FREE VS Code / PyCharm Extensions I Use</h2><p>‚úÖ Write cleaner code with Sourcery, instant refactoring suggestions: <a href="https://sourcery.ai/?utm_source=youtube&amp;utm_campaign=pythonengineer" target="_blank">Link *</a></p><p class="affiliate-note">* This is an affiliate link. By clicking on it you will not have any additional costs, instead you will support me and my project. Thank you! üôè</p></div></div><a class="sponsor-container" href="../../newsletter/index.html" rel="nofollow"><img class="main" src="../../images/numpyhandbook.webp" alt="newsletter"/><div><h2>FREE NumPy Handbook</h2><p>Learn NumPy with this eBook! It covers code examples for all essential functions. Get it for free together with monthly Python tips and news.</p><button class="pill-button">I Want This</button></div></a><div><div><a class="section-header pad-top" href="../../courses/index.html"><h2>Check out my Courses</h2></a><ul class="item-list grid"><li><article class="post-card"><a href="../../courses/tensorflowbeginner/index.html"><img class="post-thumb" alt="Thumbnail image of the post." src="../../images/titles/tfcourse.webp"/></a><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li><li class="variant-f"><a href="../../tags/tensorflow/index.html">TensorFlow</a></li><li class="variant-c"><a href="../../tags/deep-learning/index.html">Deep Learning</a></li></ul><a class="post-link" href="../../courses/tensorflowbeginner/index.html"><h1 class="description">TensorFlow 2 Beginner</h1><p>Learn all the necessary basics to get started with TensorFlow 2 and Keras.</p></a></article></li><li><article class="post-card"><a href="../../courses/pytorchbeginner/index.html"><img class="post-thumb" alt="Thumbnail image of the post." src="../../images/titles/pytorchcourse.webp"/></a><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li><li class="variant-c"><a href="../../tags/pytorch/index.html">PyTorch</a></li><li class="variant-c"><a href="../../tags/deep-learning/index.html">Deep Learning</a></li></ul><a class="post-link" href="../../courses/pytorchbeginner/index.html"><h1 class="description">PyTorch Beginner</h1><p>Learn all the necessary basics to get started with this deep learning framework.</p></a></article></li><li><article class="post-card"><a href="../../courses/mlfromscratch/index.html"><img class="post-thumb" alt="Thumbnail image of the post." src="../../images/titles/mlfromscratch.webp"/></a><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li><li class="variant-b"><a href="../../tags/machine-learning/index.html">Machine Learning</a></li><li class="variant-d"><a href="../../tags/numpy/index.html">numpy</a></li></ul><a class="post-link" href="../../courses/mlfromscratch/index.html"><h1 class="description">ML From Scratch</h1><p>Implement popular Machine Learning algorithms from scratch using only built-in Python modules and numpy.</p></a></article></li><li><article class="post-card"><a href="../../courses/advancedpython/index.html"><img class="post-thumb" alt="Thumbnail image of the post." src="../../images/titles/advancedpythoncourse.webp"/></a><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li></ul><a class="post-link" href="../../courses/advancedpython/index.html"><h1 class="description">Advanced Python</h1><p>Advanced Python Tutorials. It covers topics like collections, decorators, generators, multithreading, logging, and much more.</p></a></article></li></ul></div></div></article><footer><div class="wrapper patreon-footer"><h1>Patreon</h1><p>Become a Patron and get exclusive content! Get access to ML From Scratch notebooks, join a private Discord channel, get priority response, and more!</p><div class="gold-patrons"><h3>Special thanks to my Gold Patreons:</h3><p>Tonja J R</p><p>Daniel And Andy</p><p>Sergei</p></div><p>And of course thanks to every other member! I really appreciate the support!</p><a href="https://www.patreon.com/patrickloeber" target="_blank">Find Out More</a></div><div class="wrapper"><p>Copyright ¬© Python Engineer 2022.</p><p>Generated using <a href="https://github.com/johnsundell/publish" target="_blank">Publish</a>.</p><ul class="footer-links"><li><a class="youtube-button youtube-icon" href="https://www.youtube.com/channel/UCbXgNpp0jedKWcQiULLbDTA" target="_blank">YouTube</a></li><li><a class="social-button twitter-button" href="https://twitter.com/python_engineer" target="_blank">Twitter</a></li><li><a class="social-button github-button" href="https://github.com/python-engineer" target="_blank">GitHub</a></li><li><a class="social-button discord-button" href="https://discord.gg/FHMg9tKFSN" target="_blank">Discord</a></li><li><a class="footer-button" href="../../feed.rss">RSS</a></li><li><a class="footer-button" href="../../about/index.html">Contact</a></li><li><a class="footer-button" href="../../legal-notice/index.html">Legal Notice</a></li><li><a class="footer-button" href="../../privacy-policy/index.html">Privacy Policy</a></li></ul></div></footer></body>
<!-- Mirrored from www.python-engineer.com/posts/apple-health-data-python/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Sep 2022 12:01:49 GMT -->
</html>