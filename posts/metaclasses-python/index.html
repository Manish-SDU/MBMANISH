<!DOCTYPE html><html lang="en">
<!-- Mirrored from www.python-engineer.com/posts/metaclasses-python/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Sep 2022 12:01:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head><meta charset="UTF-8"/><meta name="og:site_name" content="Python Engineer"/><link rel="canonical" href="https://python-engineer.com/posts/metaclasses-python"/><meta name="twitter:url" content="https://python-engineer.com/posts/metaclasses-python"/><meta name="og:url" content="https://python-engineer.com/posts/metaclasses-python"/><title>What are metaclasses in Python | Python Engineer</title><meta name="twitter:title" content="What are metaclasses in Python | Python Engineer"/><meta name="og:title" content="What are metaclasses in Python | Python Engineer"/><meta name="description" content="A beginners guide to metaclasses in Python."/><meta name="twitter:description" content="A beginners guide to metaclasses in Python."/><meta name="og:description" content="A beginners guide to metaclasses in Python."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="../../styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="../../images/favicon.png" type="image/png"/><link rel="alternate" href="../../feed.rss" type="application/rss+xml" title="Subscribe to Python Engineer"/><meta name="twitter:image" content="../../images/icon.png"/><meta name="og:image" content="../../images/icon.png"/><script async defer data-domain="python-engineer.com" src="../../../plausible.io/js/plausible.js"></script></head><body class="item"><header><div class="header-promotion"><p><div class="wrapper"><p><a href="https://pythonengineer.pallet.com/" target="_blank">üêç Find Python and ML Jobs! üêç</a></p></div></p></div><div class="wrapper"><nav><ul><li class="selected"><a href="../index.html">POSTS</a></li><li><a href="../../courses/index.html">COURSES</a></li><li><a href="../../about/index.html">ABOUT</a></li></ul></nav><a href="../../index.html"><div class="hero-container"><img class="header-image-small" src="../../images/pat_face_bg.webp" alt="Patrick Loeber"/><div class="hero-text-container justify-center"><p>Become a</p><h1 class="colorized-text ">Python Engineer</h1><p class="mobile-hide">Come and learn about</p><ul class="mobile-hide"><li><a class="variant-a" href="../../tags/python/index.html">Python</a></li><li id="regular-li">and</li><li><a class="variant-b" href="../../tags/machine-learning/index.html">Machine Learning</a></li></ul></div></div></a></div></header><article class="page wrapper post-page"><h1 class="blog-header">What are metaclasses in Python</h1><div class="metadata"><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li><li class="variant-a"><a href="../../tags/basics/index.html">Basics</a></li></ul><span class="post-date">07 Feb 2022, by </span><a class="author-link-post" href="../../authors/pratik/index.html">Pratik Choudhari</a></div><div class="content page-content"><p>Metaclass is an advanced Python concept and is not used in day-to-day programming tasks. They allow a user to precisely define a class state, change its attributes and control method behavior.</p><p>In this article, we will understand how metaclasses can be created and used in Python.</p><h2>1. Type and OOP</h2><p>Everything is an object in Python, including classes. Hence, if classes are an object, they must be created by another class also called as Metaclass.</p><img src="../../images/2022-01-29-metaclasses/metaclass.webp" alt="class hierarchy"/><p>So, a metaclass is just another class that creates class objects. Usually, <code>type</code> is the built-in metaclass Python uses for every class. But we can also create our own metaclasses with custom behavior.</p><h2>2. Understanding the <code>type()</code> function</h2><p>To fully understand Metaclasses, one needs to thoroughly understand <code>type()</code>.</p><p>In Python, <code>type()</code> is used to identify the data type of a variable. If we have the following code</p><pre><code><div class="highlight"><span></span><span class="n">var</span> <span class="o">=</span> <span class="mi">12</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
</div></code></pre><p>Console output would be:</p><pre><code><div class="highlight"><span></span><span class="go">&lt;class &#39;int&#39;&gt;</span>
</div></code></pre><p>Indicating <code>var</code> is an instance of the class <code>int</code>.</p><p>In the case of a user-defined class, we get the following output.</p><pre><code><div class="highlight"><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
        <span class="k">pass</span>

<span class="n">foo_obj</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type of Foo&#39;s instance is:&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">foo_obj</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type of Foo is:&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">Foo</span><span class="p">))</span>
</div></code></pre><pre><code><div class="highlight"><span></span><span class="go">Type of Foo&#39;s instance is: &lt;class &#39;__main__.Foo&#39;&gt;</span>
<span class="go">Type of Foo is: &lt;class &#39;type&#39;&gt;</span>
</div></code></pre><p>Here, we can see <code>foo_obj</code> is correctly identified as an instance of class <code>Foo</code>, but the type of class <code>Foo</code> indicates that it is an instance of class <code>type</code>, establishing the point that classes are indeed created by other classes.</p><h2>Creating classes dynamically using <code>type()</code></h2><p>This is one more concept we should know before diving into metaclasses.</p><p>This usage of <code>type()</code> is fairly unknown. The <code>type()</code> function can take three arguments and can be used to create classes dynamically:</p><pre><code><div class="highlight"><span></span><span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bases</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span>
</div></code></pre><ul><li><code>name</code> indicates the name of a class</li><li><code>bases</code> is a tuple of classes to be inherited</li><li><code>attributes</code> is a dictionary including all variables and methods to be declared inside the new class</li></ul><p>Example:</p><pre><code><div class="highlight"><span></span><span class="n">Dummy</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s2">&quot;Dummy&quot;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;var1&quot;</span><span class="p">:</span> <span class="s2">&quot;lorem ipsum sit domat&quot;</span><span class="p">})</span>
<span class="n">dummy</span> <span class="o">=</span> <span class="n">Dummy</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dummy</span><span class="o">.</span><span class="n">var1</span><span class="p">)</span>
</div></code></pre><p>Output:</p><pre><code><div class="highlight"><span></span><span class="go">lorem ipsum sit domat</span>
</div></code></pre><h2>3. Creating Metaclass</h2><p>The main purpose of a metaclass is to change the class automatically when it's created.</p><p>To use class as a metaclass we pass <code>metaclass=ClassName</code> as a class parameter. The metaclass itself is implemented like a normal class with any behavior we want. Usually the <code>__new__</code> function is implemented.</p><p>The name of the metaclass should ideally make the intent of the class clear:</p><p>Example:</p><pre><code><div class="highlight"><span></span><span class="k">class</span> <span class="nc">PrintAttributeMeta</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Attributes received in PrintAttributeMeta:&quot;</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Dummy</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">PrintAttributeMeta</span><span class="p">):</span>
    <span class="n">class_var1</span> <span class="o">=</span> <span class="s2">&quot;lorem&quot;</span>
    <span class="n">class_var2</span> <span class="o">=</span> <span class="mi">45</span>
</div></code></pre><p>Output:</p><pre><code><div class="highlight"><span></span><span class="go">Attributes received in PrintAttributeMeta: {&#39;__module__&#39;: &#39;__main__&#39;, &#39;__qualname__&#39;: &#39;Dummy&#39;, &#39;class_var1&#39;: &#39;lorem&#39;, &#39;class_var2&#39;: 45}</span>
</div></code></pre><p>This meta class simply prints all attributes, and then creates and returns a new class by using the <code>type()</code> function.</p><p>Note that there‚Äôs output without creating an instance of the class because the <code>__new__()</code> method is called when the class is created.</p><h2>4. Modifying a class state using Metaclass</h2><p>Using Metaclasses, the user can perform multitude of validations and modification such as changing variable names, raising error on receiving an invalid data type, checking inheritance levels, etc.</p><p>For this example, we will write a Metaclass that raises a <code>ValueError</code> when a negative value is received in <code>attributes</code>.</p><pre><code><div class="highlight"><span></span><span class="k">class</span> <span class="nc">PositiveNumbersMeta</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Negative values are not allowed in </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">PositiveNumbersMeta</span><span class="p">):</span>
    <span class="n">class_var1</span> <span class="o">=</span> <span class="mi">23</span>
    <span class="n">class_var2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</div></code></pre><p>Output:</p><pre><code><div class="highlight"><span></span><span class="go">Traceback (most recent call last):</span>
<span class="go">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">  File &quot;&lt;stdin&gt;&quot;, line 5, in __new__</span>
<span class="go">ValueError: Negative values are not allowed in MyClass</span>
</div></code></pre><p>We could also change attributes:</p><pre><code><div class="highlight"><span></span><span class="k">class</span> <span class="nc">PositiveNumbersMeta</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">attributes</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">value</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">PositiveNumbersMeta</span><span class="p">):</span>
    <span class="n">class_var1</span> <span class="o">=</span> <span class="mi">23</span>
    <span class="n">class_var2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">class_var2</span><span class="p">)</span>  <span class="c1"># 1</span>
</div></code></pre><h2>5. Use proper OOP principles</h2><p>In the previous example we are calling <code>type</code> directly and aren't overriding or calling the parent's <code>__new__</code>. Let's do that instead:</p><pre><code><div class="highlight"><span></span><span class="k">class</span> <span class="nc">PositiveNumbersMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">attributes</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">value</span>
        <span class="k">return</span> <span class="nb">super</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
</div></code></pre><p>Now our metaclass inherits from <code>type</code>, and by calling the <code>super.__new__()</code> we are using the OOP syntax and call the <code>__new__()</code> function of the base class.</p><h2>6. When to use metaclasses?</h2><p>There are several reasons to do so:</p><ul><li>The intention is clear. When you read PositiveNumbersMeta, you know what's going to follow</li><li>You can use OOP. Metaclass can inherit from metaclass, override parent methods, etc. Metaclasses can even use other metaclasses.</li><li>You can structure your code better. You never use metaclasses for something as trivial as the above example. It's usually for something complicated. Having the ability to make several methods and group them in one class is very useful to make the code easier to read.</li><li>You can hook on <code>__new__</code>, <code>__init__</code> and <code>__call__</code>. Which will allow you to do different stuff, Even if usually you can do it all in <code>__new__</code>, some people are just more comfortable using <code>__init__</code>.</li></ul><p>Resource: Here's a great <a href="https://stackoverflow.com/questions/100003/what-are-metaclasses-in-python">StackOverflow answer</a> that explains it well.</p><p>Note that Metaclasses are usually only used in more complex scenarios, and in 99% of cases you don't have to worry about it. One common use case is when creating an API. A typical example of this is the <a href="https://docs.djangoproject.com/en/4.0/topics/db/models/">Django ORM</a>.</p></div><ul class="actions"><li><a class="youtube-button" href="https://www.youtube.com/channel/UCbXgNpp0jedKWcQiULLbDTA?sub_confirmation=1" target="_blank" rel="nofollow">Subscribe</a></li><li><a class="twitter-button" href="https://twitter.com/intent/tweet?via=python_engineer&amp;text=What%20are%20metaclasses%20in%20Python&amp;url=https://python-engineer.com/posts/metaclasses-python" rel="nofollow" target="_blank">Share</a></li></ul><div class="affiliate-container"><div><h2>FREE VS Code / PyCharm Extensions I Use</h2><p>‚úÖ Write cleaner code with Sourcery, instant refactoring suggestions: <a href="https://sourcery.ai/?utm_source=youtube&amp;utm_campaign=pythonengineer" target="_blank">Link *</a></p><p class="affiliate-note">* This is an affiliate link. By clicking on it you will not have any additional costs, instead you will support me and my project. Thank you! üôè</p></div></div><a class="sponsor-container" href="../../newsletter/index.html" rel="nofollow"><img class="main" src="../../images/numpyhandbook.webp" alt="newsletter"/><div><h2>FREE NumPy Handbook</h2><p>Learn NumPy with this eBook! It covers code examples for all essential functions. Get it for free together with monthly Python tips and news.</p><button class="pill-button">I Want This</button></div></a><div><div><a class="section-header pad-top" href="../../courses/index.html"><h2>Check out my Courses</h2></a><ul class="item-list grid"><li><article class="post-card"><a href="../../courses/tensorflowbeginner/index.html"><img class="post-thumb" alt="Thumbnail image of the post." src="../../images/titles/tfcourse.webp"/></a><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li><li class="variant-f"><a href="../../tags/tensorflow/index.html">TensorFlow</a></li><li class="variant-c"><a href="../../tags/deep-learning/index.html">Deep Learning</a></li></ul><a class="post-link" href="../../courses/tensorflowbeginner/index.html"><h1 class="description">TensorFlow 2 Beginner</h1><p>Learn all the necessary basics to get started with TensorFlow 2 and Keras.</p></a></article></li><li><article class="post-card"><a href="../../courses/pytorchbeginner/index.html"><img class="post-thumb" alt="Thumbnail image of the post." src="../../images/titles/pytorchcourse.webp"/></a><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li><li class="variant-c"><a href="../../tags/pytorch/index.html">PyTorch</a></li><li class="variant-c"><a href="../../tags/deep-learning/index.html">Deep Learning</a></li></ul><a class="post-link" href="../../courses/pytorchbeginner/index.html"><h1 class="description">PyTorch Beginner</h1><p>Learn all the necessary basics to get started with this deep learning framework.</p></a></article></li><li><article class="post-card"><a href="../../courses/mlfromscratch/index.html"><img class="post-thumb" alt="Thumbnail image of the post." src="../../images/titles/mlfromscratch.webp"/></a><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li><li class="variant-b"><a href="../../tags/machine-learning/index.html">Machine Learning</a></li><li class="variant-d"><a href="../../tags/numpy/index.html">numpy</a></li></ul><a class="post-link" href="../../courses/mlfromscratch/index.html"><h1 class="description">ML From Scratch</h1><p>Implement popular Machine Learning algorithms from scratch using only built-in Python modules and numpy.</p></a></article></li><li><article class="post-card"><a href="../../courses/advancedpython/index.html"><img class="post-thumb" alt="Thumbnail image of the post." src="../../images/titles/advancedpythoncourse.webp"/></a><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li></ul><a class="post-link" href="../../courses/advancedpython/index.html"><h1 class="description">Advanced Python</h1><p>Advanced Python Tutorials. It covers topics like collections, decorators, generators, multithreading, logging, and much more.</p></a></article></li></ul></div></div></article><footer><div class="wrapper patreon-footer"><h1>Patreon</h1><p>Become a Patron and get exclusive content! Get access to ML From Scratch notebooks, join a private Discord channel, get priority response, and more!</p><div class="gold-patrons"><h3>Special thanks to my Gold Patreons:</h3><p>Tonja J R</p><p>Daniel And Andy</p><p>Sergei</p></div><p>And of course thanks to every other member! I really appreciate the support!</p><a href="https://www.patreon.com/patrickloeber" target="_blank">Find Out More</a></div><div class="wrapper"><p>Copyright ¬© Python Engineer 2022.</p><p>Generated using <a href="https://github.com/johnsundell/publish" target="_blank">Publish</a>.</p><ul class="footer-links"><li><a class="youtube-button youtube-icon" href="https://www.youtube.com/channel/UCbXgNpp0jedKWcQiULLbDTA" target="_blank">YouTube</a></li><li><a class="social-button twitter-button" href="https://twitter.com/python_engineer" target="_blank">Twitter</a></li><li><a class="social-button github-button" href="https://github.com/python-engineer" target="_blank">GitHub</a></li><li><a class="social-button discord-button" href="https://discord.gg/FHMg9tKFSN" target="_blank">Discord</a></li><li><a class="footer-button" href="../../feed.rss">RSS</a></li><li><a class="footer-button" href="../../about/index.html">Contact</a></li><li><a class="footer-button" href="../../legal-notice/index.html">Legal Notice</a></li><li><a class="footer-button" href="../../privacy-policy/index.html">Privacy Policy</a></li></ul></div></footer></body>
<!-- Mirrored from www.python-engineer.com/posts/metaclasses-python/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Sep 2022 12:01:42 GMT -->
</html>