<!DOCTYPE html><html lang="en">
<!-- Mirrored from www.python-engineer.com/posts/django-async-views/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Sep 2022 12:01:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head><meta charset="UTF-8"/><meta name="og:site_name" content="Python Engineer"/><link rel="canonical" href="https://python-engineer.com/posts/django-async-views"/><meta name="twitter:url" content="https://python-engineer.com/posts/django-async-views"/><meta name="og:url" content="https://python-engineer.com/posts/django-async-views"/><title>Async Views in Django 3.1 | Python Engineer</title><meta name="twitter:title" content="Async Views in Django 3.1 | Python Engineer"/><meta name="og:title" content="Async Views in Django 3.1 | Python Engineer"/><meta name="description" content="Learn about new Django async features like async views, middleware, and tests."/><meta name="twitter:description" content="Learn about new Django async features like async views, middleware, and tests."/><meta name="og:description" content="Learn about new Django async features like async views, middleware, and tests."/><meta name="twitter:card" content="summary_large_image"/><link rel="stylesheet" href="../../styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="../../images/favicon.png" type="image/png"/><link rel="alternate" href="../../feed.rss" type="application/rss+xml" title="Subscribe to Python Engineer"/><meta name="twitter:image" content="https://python-engineer.com/djangoasync.webp"/><meta name="og:image" content="https://python-engineer.com/djangoasync.webp"/><script async defer data-domain="python-engineer.com" src="../../../plausible.io/js/plausible.js"></script></head><body class="item"><header><div class="header-promotion"><p><div class="wrapper"><p><a href="https://pythonengineer.pallet.com/" target="_blank">üêç Find Python and ML Jobs! üêç</a></p></div></p></div><div class="wrapper"><nav><ul><li class="selected"><a href="../index.html">POSTS</a></li><li><a href="../../courses/index.html">COURSES</a></li><li><a href="../../about/index.html">ABOUT</a></li></ul></nav><a href="../../index.html"><div class="hero-container"><img class="header-image-small" src="../../images/pat_face_bg.webp" alt="Patrick Loeber"/><div class="hero-text-container justify-center"><p>Become a</p><h1 class="colorized-text ">Python Engineer</h1><p class="mobile-hide">Come and learn about</p><ul class="mobile-hide"><li><a class="variant-a" href="../../tags/python/index.html">Python</a></li><li id="regular-li">and</li><li><a class="variant-b" href="../../tags/machine-learning/index.html">Machine Learning</a></li></ul></div></div></a></div></header><article class="page wrapper post-page"><h1 class="blog-header">Async Views in Django 3.1</h1><div class="metadata"><ul class="tags"><li class="variant-g"><a href="../../tags/web/index.html">Web</a></li></ul><span class="post-date">09 Jul 2021, by </span><a class="author-link-post" href="../../authors/patrick/index.html">Patrick Loeber</a></div><div class="blog-image"><img alt="Thumbnail image of the post." src="../../images/titles/djangoasync.webp"/></div><div class="content page-content m-top"><p>Django 3.1. finally <a href="https://docs.djangoproject.com/en/3.1/releases/3.1/#asynchronous-views-and-middleware-support">supports</a> async views, middleware, and tests. This article gives an <strong>overview of the new asynchronous features</strong>, why it‚Äôs important, and how you can use it with little effort to speed up your application. Along the way we build a small demo application demonstrating how to implement the async functionalities.</p><h2>Why Async?</h2><p><a href="https://docs.python.org/3/library/asyncio.html">Asych IO</a> is a <strong>concurrent programming design</strong> that enables ‚Äûpausing‚Äú a function while waiting on the result and letting other functions (routines) run in the meantime. With this you can achieve a more <strong>efficient use of resources</strong> compared to a synchronous approach. It is often a perfect fit for IO-bound tasks such as</p><ul><li>Reading from/writing to files</li><li>Making calls to external APIs or websites and waiting for the response</li><li>Interacting with a database</li><li>Calling other microservices to perform background tasks, e.g., to send emails</li></ul><p>So if you build applications that have to deal with a high number of tasks simultaneously, then your app might benefit a lot from an asynchronous code. Let‚Äôs have a look at one such example in action!</p><h2>Creating The Project</h2><p>In this tutorial we build a simple Django application that lets us plan a roundtrip through five different cities. In order to see if our destinations are a good choice, we want to know the weather in each of these cities. In our app this means we have to make <strong>five calls to an external weather API</strong>, and it takes a significant amount of time for each request until the response is received. This is an example where we can really benefit from an asynchronous approach, because instead of making one request after the other, we can now make concurrent requests for all cities.</p><p>Let‚Äôs start by creating our project. For more information have a look at the <a href="https://docs.djangoproject.com/en/3.2/topics/install/">installation and setup commands</a></p><pre><code><div class="highlight"><span></span><span class="err">$</span> <span class="n">mkdir</span> <span class="n">django</span><span class="o">-</span><span class="n">tutorial</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">django</span><span class="o">-</span><span class="n">tutorial</span>
<span class="err">$</span> <span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="n">venv</span>
<span class="err">$</span> <span class="n">source</span> <span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>

<span class="p">(</span><span class="n">venv</span><span class="p">)</span><span class="err">$</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">django</span>
<span class="p">(</span><span class="n">venv</span><span class="p">)</span><span class="err">$</span> <span class="n">django</span><span class="o">-</span><span class="n">admin</span><span class="o">.</span><span class="n">py</span> <span class="n">startproject</span> <span class="n">roundtrip</span> <span class="o">.</span>
</div></code></pre><h2>Sync and Async Views</h2><p>To demonstrate the benefit of asynchronous views, let‚Äôs implement both a synchronous and an asynchronous view. Create a new file <code>roundtrip/views.py</code> and add two view functions like this:</p><pre><code><div class="highlight"><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span>

<span class="k">def</span> <span class="nf">weather_sync</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello World!&quot;</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">weather_async</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello Async World!&quot;</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</div></code></pre><p>Note that for the asynchronous view we declare the function with <code>async def</code> . You can learn more about the <code>async/await</code> syntax <a href="https://docs.python.org/3/library/asyncio-task.html#coroutines">here</a>.</p><p>Update the URLS in <code>roundtrip/urls.py</code>:</p><pre><code><div class="highlight"><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">roundtrip.views</span> <span class="kn">import</span> <span class="n">weather_sync</span><span class="p">,</span> <span class="n">weather_async</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;sync/&quot;</span><span class="p">,</span> <span class="n">weather_sync</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;async/&quot;</span><span class="p">,</span> <span class="n">weather_async</span><span class="p">)</span>
<span class="p">]</span>
</div></code></pre><h2>Run The Application</h2><p>Initialize Django and start the development server:</p><pre><code><div class="highlight"><span></span><span class="p">(</span><span class="n">venv</span><span class="p">)</span><span class="err">$</span> <span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span>
<span class="p">(</span><span class="n">venv</span><span class="p">)</span><span class="err">$</span> <span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">runserver</span>  
</div></code></pre><p>In the browser we can navigate to <code>http://127.0.0.1:8000/sync/</code> and to <code>http://127.0.0.1:8000/async/</code> to test our to views. For both routes we should see the corresponding JSON response.</p><h2>Speed Up The Application With Concurrent Code</h2><p>Now we implement the requests to the external API. For this we need a HTTP client with async support. We use <code>httpx</code> here. Open the Terminal window and install it:</p><pre><code><div class="highlight"><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">httpx</span>
</div></code></pre><p>Add the following code in <code>roundtrip/views.py</code></p><pre><code><div class="highlight"><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">httpx</span>

<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span>


<span class="k">def</span> <span class="nf">http_call_sync</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sync call to </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">http_call_async</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;async call to </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</div></code></pre><p>In both functions we implement an HTTP GET request to the given url and return the response in JSON format. We <strong>simulate a computing time of 1 second</strong> by using the <code>sleep(1)</code> function. Note that in the async case we need to use <code>asyncio.sleep(1)</code> . To learn more about asyncio and coroutines with the async/await syntax, I recommend to read through the official <a href="https://docs.python.org/3/library/asyncio-task.html">docs</a>.</p><p>Now modify the two views and add the functionality to call the weather API for different cities. As our external weather API we can use the simple <a href="https://talkpython.fm/">Talk Python</a> weather service:</p><pre><code><div class="highlight"><span></span><span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://weather.talkpython.fm/api/weather&quot;</span>
<span class="n">cities</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;portland&quot;</span><span class="p">,</span> <span class="s2">&quot;berlin&quot;</span><span class="p">,</span> <span class="s2">&quot;chicago&quot;</span><span class="p">,</span> <span class="s2">&quot;madrid&quot;</span><span class="p">,</span> <span class="s2">&quot;sidney&quot;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">weather_sync</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">cities</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">http_call_sync</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">?city=</span><span class="si">{</span><span class="n">city</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;responses&quot;</span><span class="p">:</span> <span class="n">responses</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">weather_async</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">cities</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">http_call_async</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">?city=</span><span class="si">{</span><span class="n">city</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

    <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;responses&quot;</span><span class="p">:</span> <span class="n">responses</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</div></code></pre><p>Go to <code>http://127.0.0.1:8000/sync/</code> and test it. After around five seconds you should see the returned JSON data. Now test the async view at <code>http://127.0.0.1:8000/async/</code>. You should see the result much faster!</p><p>What is happening here?</p><p>The synchronous approach should be straightforward. We make one API call after the other and append the received data to the result. For each call we need to wait one second, thus taking at least five seconds in total. But what about the async function?</p><p>When applying the <code>http_call_async</code> , the function code is not yet executed. Instead we get back <strong>an awaitable object</strong> that we can use at a later point. <code>asyncio.gather()</code> is then used to <strong>run all awaitable objects concurrently</strong>. At this point we use the <code>await</code> keyword, meaning here we wait until we get all actual results back. In each async function we still sleep for one second. But since all functions are now running concurrently, Python can intelligently use the waiting time and execute one of the other functions in the meanwhile. As a result, we get the response much faster!</p><h2>Async Tests</h2><p>Now that we are able to build async views, it would be really nice to <strong>test them asynchronously</strong>, too. Since Django 3.1 this is also very simple. Create a new file <code>roundtrip/test_views.py</code> with the following code:</p><pre><code><div class="highlight"><span></span><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">AsyncClient</span>


<span class="k">class</span> <span class="nc">TestApiWithClient</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">test_api_with_async_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">AsyncClient</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/async/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;location&quot;</span><span class="p">][</span><span class="s2">&quot;city&quot;</span><span class="p">],</span> <span class="s2">&quot;Portland&quot;</span><span class="p">)</span>
</div></code></pre><p>In order to run Django tests we need to execute <code>python manage.py test</code>. This will execute all tests and summarize the results. In our case, all tests should pass.</p><h2>Async Middleware</h2><p><a href="https://docs.djangoproject.com/en/3.2/topics/http/middleware/">Middleware</a> is a framework of hooks into Django‚Äôs request/response processing. It‚Äôs a light ‚Äûplugin‚Äú system for <strong>globally altering the input or output</strong>. It can now support any combination of synchronous and asynchronous requests. Add a new file <code>roundtrip/middleware.py</code> with the following code, making use of the <code>@sync_and_async_middleware</code> decorator to cover both cases:</p><pre><code><div class="highlight"><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span>
<span class="kn">from</span> <span class="nn">django.utils.decorators</span> <span class="kn">import</span> <span class="n">sync_and_async_middleware</span>


<span class="nd">@sync_and_async_middleware</span>
<span class="k">def</span> <span class="nf">timing_middleware</span><span class="p">(</span><span class="n">get_response</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">get_response</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">middleware</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_response</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;elapsed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">middleware</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">get_response</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;elapsed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">middleware</span>
</div></code></pre><p>To take effect, you also have to add this middleware to <code>roundtrip/settings.py</code>.</p><pre><code><div class="highlight"><span></span><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="err">‚Ä¶</span>
    <span class="s1">&#39;roundtrip.middleware.timing_middleware&#39;</span><span class="p">,</span>
<span class="p">]</span>
</div></code></pre><p>When testing the two views in the browser, you should now see a new field in the returned JSON data containing the elapsed time for the request. Test it and find out how much faster the asynchronous view is!</p><h2>ASGI Server</h2><p>Until now, we‚Äôve used the built-in Django development server. It is able to detect async views and runs them in a thread within its own <a href="https://docs.python.org/3/library/asyncio-eventloop.html">event loop</a> . But to get actual asynchronous support, <strong>we need to use an</strong> <a href="https://asgi.readthedocs.io/en/latest/">ASGI</a> <strong>server</strong>. A popular choice is <a href="https://www.uvicorn.org/">Uvicorn</a> . Install it with:</p><pre><code><div class="highlight"><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">uvicorn</span>
</div></code></pre><p>And from the project‚Äôs root directory we can start it with:</p><pre><code><div class="highlight"><span></span><span class="n">uvicorn</span> <span class="n">roundtrip</span><span class="p">.</span><span class="n">asgi</span><span class="p">:</span><span class="n">application</span> <span class="o">--</span><span class="n">reload</span>
</div></code></pre><p>For more information on how to run Django with uvicorn in production have a look at the <a href="https://docs.djangoproject.com/en/3.2/howto/deployment/asgi/uvicorn/">official docs</a>.</p><h2>Async Adapter Functions</h2><p>The ORM and other parts of Django are not completely async capable yet. So <strong>sometimes it is necessary to adapt the calling style when calling sync code from an async context, or vice-versa</strong>. For this there are two adapter functions: <a href="https://docs.djangoproject.com/en/3.2/topics/async/#asgiref.sync.async_to_sync">async<em>to</em>sync()</a> and <a href="https://docs.djangoproject.com/en/3.2/topics/async/#asgiref.sync.sync_to_async">sync<em>to</em>async()</a> . Both can be used either as a wrapper or a decorator. Don‚Äôt just make a synchronous and an asynchronous call inside an async view! So for example if you have to interact with the database in an async view, you should use the <code>sync_to_async()</code> function:</p><pre><code><div class="highlight"><span></span><span class="kn">from</span> <span class="nn">asgiref.sync</span> <span class="kn">import</span> <span class="n">sync_to_async</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">async_with_sync_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
    <span class="n">async_function</span> <span class="o">=</span> <span class="n">sync_to_async</span><span class="p">(</span><span class="n">some_sync_call</span><span class="p">)</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">async_function</span><span class="p">())</span>
    <span class="c1"># ...</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div></code></pre><h2>Conclusion</h2><p>In this article we learned about the new async features in Django and how they can be implemented. For many use-cases, especially for I/O bound tasks, concurrent code can speed up the application a lot. In order to extend this simple demo application, there are some more things you can try out in your async views, e.g., sending emails and reading from/writing to files.</p><h2>Resources</h2><ul><li><a href="https://wersdoerfer.de/blogs/ephes_blog/django-31-async/">https://wersdoerfer.de/blogs/ephes_blog/django-31-async/</a></li><li><a href="https://testdriven.io/blog/django-async-views/">Async Views in Django 3.1 | TestDriven.io</a></li></ul></div><ul class="actions"><li><a class="youtube-button" href="https://www.youtube.com/channel/UCbXgNpp0jedKWcQiULLbDTA?sub_confirmation=1" target="_blank" rel="nofollow">Subscribe</a></li><li><a class="twitter-button" href="https://twitter.com/intent/tweet?via=python_engineer&amp;text=Async%20Views%20in%20Django%203.1&amp;url=https://python-engineer.com/posts/django-async-views" rel="nofollow" target="_blank">Share</a></li></ul><div class="affiliate-container"><div><h2>FREE VS Code / PyCharm Extensions I Use</h2><p>‚úÖ Write cleaner code with Sourcery, instant refactoring suggestions: <a href="https://sourcery.ai/?utm_source=youtube&amp;utm_campaign=pythonengineer" target="_blank">Link *</a></p><p class="affiliate-note">* This is an affiliate link. By clicking on it you will not have any additional costs, instead you will support me and my project. Thank you! üôè</p></div></div><a class="sponsor-container" href="../../newsletter/index.html" rel="nofollow"><img class="main" src="../../images/numpyhandbook.webp" alt="newsletter"/><div><h2>FREE NumPy Handbook</h2><p>Learn NumPy with this eBook! It covers code examples for all essential functions. Get it for free together with monthly Python tips and news.</p><button class="pill-button">I Want This</button></div></a><div><div><a class="section-header pad-top" href="../../courses/index.html"><h2>Check out my Courses</h2></a><ul class="item-list grid"><li><article class="post-card"><a href="../../courses/tensorflowbeginner/index.html"><img class="post-thumb" alt="Thumbnail image of the post." src="../../images/titles/tfcourse.webp"/></a><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li><li class="variant-f"><a href="../../tags/tensorflow/index.html">TensorFlow</a></li><li class="variant-c"><a href="../../tags/deep-learning/index.html">Deep Learning</a></li></ul><a class="post-link" href="../../courses/tensorflowbeginner/index.html"><h1 class="description">TensorFlow 2 Beginner</h1><p>Learn all the necessary basics to get started with TensorFlow 2 and Keras.</p></a></article></li><li><article class="post-card"><a href="../../courses/pytorchbeginner/index.html"><img class="post-thumb" alt="Thumbnail image of the post." src="../../images/titles/pytorchcourse.webp"/></a><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li><li class="variant-c"><a href="../../tags/pytorch/index.html">PyTorch</a></li><li class="variant-c"><a href="../../tags/deep-learning/index.html">Deep Learning</a></li></ul><a class="post-link" href="../../courses/pytorchbeginner/index.html"><h1 class="description">PyTorch Beginner</h1><p>Learn all the necessary basics to get started with this deep learning framework.</p></a></article></li><li><article class="post-card"><a href="../../courses/mlfromscratch/index.html"><img class="post-thumb" alt="Thumbnail image of the post." src="../../images/titles/mlfromscratch.webp"/></a><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li><li class="variant-b"><a href="../../tags/machine-learning/index.html">Machine Learning</a></li><li class="variant-d"><a href="../../tags/numpy/index.html">numpy</a></li></ul><a class="post-link" href="../../courses/mlfromscratch/index.html"><h1 class="description">ML From Scratch</h1><p>Implement popular Machine Learning algorithms from scratch using only built-in Python modules and numpy.</p></a></article></li><li><article class="post-card"><a href="../../courses/advancedpython/index.html"><img class="post-thumb" alt="Thumbnail image of the post." src="../../images/titles/advancedpythoncourse.webp"/></a><ul class="tags"><li class="variant-a"><a href="../../tags/python/index.html">Python</a></li></ul><a class="post-link" href="../../courses/advancedpython/index.html"><h1 class="description">Advanced Python</h1><p>Advanced Python Tutorials. It covers topics like collections, decorators, generators, multithreading, logging, and much more.</p></a></article></li></ul></div></div></article><footer><div class="wrapper patreon-footer"><h1>Patreon</h1><p>Become a Patron and get exclusive content! Get access to ML From Scratch notebooks, join a private Discord channel, get priority response, and more!</p><div class="gold-patrons"><h3>Special thanks to my Gold Patreons:</h3><p>Tonja J R</p><p>Daniel And Andy</p><p>Sergei</p></div><p>And of course thanks to every other member! I really appreciate the support!</p><a href="https://www.patreon.com/patrickloeber" target="_blank">Find Out More</a></div><div class="wrapper"><p>Copyright ¬© Python Engineer 2022.</p><p>Generated using <a href="https://github.com/johnsundell/publish" target="_blank">Publish</a>.</p><ul class="footer-links"><li><a class="youtube-button youtube-icon" href="https://www.youtube.com/channel/UCbXgNpp0jedKWcQiULLbDTA" target="_blank">YouTube</a></li><li><a class="social-button twitter-button" href="https://twitter.com/python_engineer" target="_blank">Twitter</a></li><li><a class="social-button github-button" href="https://github.com/python-engineer" target="_blank">GitHub</a></li><li><a class="social-button discord-button" href="https://discord.gg/FHMg9tKFSN" target="_blank">Discord</a></li><li><a class="footer-button" href="../../feed.rss">RSS</a></li><li><a class="footer-button" href="../../about/index.html">Contact</a></li><li><a class="footer-button" href="../../legal-notice/index.html">Legal Notice</a></li><li><a class="footer-button" href="../../privacy-policy/index.html">Privacy Policy</a></li></ul></div></footer></body>
<!-- Mirrored from www.python-engineer.com/posts/django-async-views/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Sep 2022 12:01:50 GMT -->
</html>